<!-- ğŸ”¥ FORMULARIO SOLICITUD SIMPLIFICADO - 1 CLICK -->
<div class="form-container">
  <div class="card-servicio">
    <div class="header-gradient">
      <h2>ğŸ“‹ Solicitar Servicio</h2>
      <div class="step-indicator">
        <div class="step active">1. Formulario</div>
        <div class="step-connector"></div>
        <div class="step" [class.active]="nuevaCita">2. Â¡Listo!</div>
      </div>
    </div>

    <!-- ğŸ’° PRECIO AUTOMÃTICO -->
    <div class="precio-display" *ngIf="precioSeleccionado() > 0">
      <span class="emoji">ğŸ’°</span>
      <strong>${{ precioSeleccionado() }} MXN</strong>
      <span class="label-precio">IVA Incluido</span>
    </div>

    <!-- ğŸ“ FORMULARIO PRINCIPAL -->
    <form [formGroup]="formSolicitud">
      <!-- ğŸ‘¤ NOMBRE COMPLETO -->
      <div class="input-group">
        <label>ğŸ‘¤ Nombre Completo *</label>
        <input formControlName="cliente" type="text" placeholder="Juan PÃ©rez" />
        <div
          class="error"
          *ngIf="formSolicitud.get('cliente')?.invalid && formSolicitud.get('cliente')?.touched"
        >
          Nombre requerido
        </div>
      </div>

      <!-- ğŸ“§ EMAIL + â˜ï¸ WHATSAPP -->
      <div class="input-row">
        <div class="input-group">
          <label>ğŸ“§ Email *</label>
          <input formControlName="email" type="email" placeholder="cliente@email.com" />
          <div
            class="error"
            *ngIf="formSolicitud.get('email')?.invalid && formSolicitud.get('email')?.touched"
          >
            Email vÃ¡lido requerido
          </div>
        </div>
        <div class="input-group">
          <label>ğŸ“± WhatsApp * (10 dÃ­gitos)</label>
          <input formControlName="telefono" type="tel" placeholder="2212345678" />
          <span
            class="telefono-status"
            [class.telefono-ok]="validarTelefono()"
            [class.telefono-error]="!validarTelefono() && formSolicitud.get('telefono')?.value"
          >
            {{ validarTelefono() ? 'âœ… VERIFICADO' : 'âŒ 10 dÃ­gitos' }}
          </span>
        </div>
      </div>

      <!-- ğŸ”§ SERVICIO + ğŸ“… FECHA -->
      <div class="input-row">
        <div class="input-group">
          <label>ğŸ”§ Servicio *</label>
          <select formControlName="servicio">
            <option value="">Selecciona servicio...</option>
            <option *ngFor="let servicio of servicios" [value]="servicio">{{ servicio }}</option>
          </select>
          <div
            class="error"
            *ngIf="formSolicitud.get('servicio')?.invalid && formSolicitud.get('servicio')?.touched"
          >
            Selecciona un servicio
          </div>
        </div>
        <div class="input-group">
          <label>ğŸ“… Fecha * (desde maÃ±ana)</label>
          <input formControlName="fecha" type="date" [min]="minFechaStr" />
          <div
            class="error"
            *ngIf="formSolicitud.get('fecha')?.invalid && formSolicitud.get('fecha')?.touched"
          >
            Fecha requerida (desde maÃ±ana)
          </div>
        </div>
      </div>

      <!-- ğŸ“ DESCRIPCIÃ“N DETALLADA -->
      <div class="input-group">
        <label>ğŸ“ Â¿QuÃ© necesita reparar? * (mÃ­n. 10 caracteres)</label>
        <textarea
          formControlName="descripcion"
          rows="4"
          placeholder="Ej: Mi laptop no enciende, hace ruido extraÃ±o al encender, pantalla parpadea..."
        ></textarea>
        <div
          class="error"
          *ngIf="
            formSolicitud.get('descripcion')?.invalid && formSolicitud.get('descripcion')?.touched
          "
        >
          Describe el problema (mÃ­nimo 10 caracteres)
        </div>
      </div>

      <!-- ğŸš« RESPONSABILIDAD LEGAL OBLIGATORIA -->
      <div class="responsabilidad-section">
        <label class="checkbox-responsabilidad">
          <input
            type="checkbox"
            [(ngModel)]="aceptoResponsabilidad"
            [ngModelOptions]="{ standalone: true }"
          />
          <span class="checkmark"></span>
          <div>
            <strong>âš ï¸ COMPROMISO FORMAL:</strong><br />
            <small>Cancelar 24h antes o pagar 50% multa</small>
          </div>
        </label>
      </div>

      <!-- ğŸ‰ BOTÃ“N CREAR CITA DIRECTA -->
      <button
        type="button"
        (click)="crearCitaDirecta()"
        [disabled]="!formCompleto()"
        class="btn-generar"
      >
        {{
          formCompleto() ? 'ğŸ‰ CREAR CITA AUTOMÃTICA' : 'âš ï¸ Completa todos los campos + checkbox'
        }}
      </button>
    </form>

    <!-- ğŸ‰ MODAL CONFIRMACIÃ“N Ã‰XITO -->
    <div class="modal-confirmacion" *ngIf="nuevaCita">
      <div class="confirmacion-card">
        <div class="success-icon">âœ…</div>
        <h2>Â¡Cita Reservada Exitosamente!</h2>

        <!-- ğŸ” ID CITA PRINCIPAL -->
        <div class="id-codigo-container">
          <div class="id-card grande">
            <span class="label">ID Cita</span>
            <strong>{{ nuevaCita.id }}</strong>
            <span class="sub-label">Guarda este ID</span>
          </div>
        </div>

        <!-- ğŸ“‹ DETALLES CITA -->
        <div class="detalles-confirmacion">
          <div class="detalle-row">
            <span>ğŸ‘¤</span> <strong>{{ nuevaCita.cliente }}</strong>
          </div>
          <div class="detalle-row"><span>ğŸ”§</span> {{ nuevaCita.servicio }}</div>
          <div class="detalle-row"><span>ğŸ“…</span> {{ nuevaCita.fecha }}</div>
          <div class="detalle-row precio-final">
            <span>ğŸ’°</span> <strong>${{ nuevaCita.costo }} MXN</strong>
          </div>
        </div>

        <!-- ğŸ“± FEEDBACK WHATSAPP -->
        <div class="whatsapp-feedback-modal" *ngIf="whatsappEnviado">
          ğŸ“± ConfirmaciÃ³n enviada a WhatsApp
        </div>

        <!-- ğŸ”— INSTRUCCIÃ“N RASTREO -->
        <div class="instruccion-rastreo">
          <p>ğŸ” <strong>Usa este ID</strong> para rastrear tu cita en:</p>
          <a routerLink="/cliente/citas" class="link-citas">ğŸ“‹ Mis Citas</a>
        </div>

        <!-- ğŸš€ BOTÃ“N FINAL -->
        <button (click)="irMisCitas()" class="btn-ir-citas">ğŸ“‹ Ver Mis Citas</button>
      </div>
    </div>
  </div>
</div>
