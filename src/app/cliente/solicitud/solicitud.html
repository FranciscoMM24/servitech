<!-- ğŸ”¥ FORMULARIO + RESPONSABILIDAD TOTAL -->
<div class="form-container">
  <div class="card-servicio">
    <h2>ğŸ“‹ Solicitar Servicio</h2>

    <!-- ğŸ’° PRECIO AUTOMÃTICO -->
    <div class="precio-display" *ngIf="precioSeleccionado() > 0">
      <span class="emoji">ğŸ’°</span>
      <strong>${{ precioSeleccionado() }} MXN</strong>
    </div>

    <!-- ğŸ“ FORMULARIO PRINCIPAL -->
    <form [formGroup]="formSolicitud">
      <div class="input-group">
        <label>ğŸ‘¤ Nombre Completo *</label>
        <input formControlName="cliente" type="text" placeholder="Juan PÃ©rez" />
        <div
          class="error"
          *ngIf="formSolicitud.get('cliente')?.invalid && formSolicitud.get('cliente')?.touched"
        >
          Nombre requerido
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>ğŸ“§ Email *</label>
          <input formControlName="email" type="email" placeholder="cliente@email.com" />
        </div>
        <div class="input-group">
          <label>ğŸ“± WhatsApp * (10 dÃ­gitos)</label>
          <input formControlName="telefono" type="tel" placeholder="2212345678" />
          <span
            class="telefono-status"
            [class.telefono-ok]="validarTelefono()"
            [class.telefono-error]="!validarTelefono() && formSolicitud.get('telefono')?.value"
          >
            {{ validarTelefono() ? 'âœ… VERIFICADO' : 'âŒ 10 dÃ­gitos' }}
          </span>
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>ğŸ”§ Servicio *</label>
          <select formControlName="servicio">
            <option value="">Selecciona...</option>
            <option *ngFor="let servicio of servicios" [value]="servicio">{{ servicio }}</option>
          </select>
        </div>
        <div class="input-group">
          <label>ğŸ“… Fecha *</label>
          <input formControlName="fecha" type="date" [min]="minFechaStr" />
        </div>
      </div>

      <div class="input-group">
        <label>ğŸ•’ Hora *</label>
        <input formControlName="hora" type="time" />
      </div>

      <div class="input-group">
        <label>ğŸ“ DescripciÃ³n * (mÃ­nimo 10 caracteres)</label>
        <textarea
          formControlName="descripcion"
          rows="4"
          placeholder="Ej: Mi laptop no enciende, hace ruido..."
        ></textarea>
        <div
          class="error"
          *ngIf="
            formSolicitud.get('descripcion')?.invalid && formSolicitud.get('descripcion')?.touched
          "
        >
          DescripciÃ³n mÃ­nima 10 caracteres
        </div>
      </div>

      <!-- ğŸš« RESPONSABILIDAD OBLIGATORIA -->
      <div class="responsabilidad-section">
        <label class="checkbox-responsabilidad">
          <input
            type="checkbox"
            [(ngModel)]="aceptoResponsabilidad"
            [ngModelOptions]="{ standalone: true }"
          />
          <span class="checkmark"></span>
          <strong>âš ï¸ COMPROMISO FORMAL:</strong> CancelarÃ© 24h antes o pagarÃ© 50% de multa
        </label>
        <p class="aviso-responsabilidad">
          <strong>SIN ESTE CHECK â†’ NO SE GENERA CÃ“DIGO</strong>
        </p>
      </div>

      <!-- ğŸ”‘ PASO 1: GENERAR CÃ“DIGO -->
      <button
        type="button"
        (click)="generarCodigo()"
        [disabled]="!formCompleto()"
        class="btn-generar"
      >
        {{
          formCompleto() ? 'ğŸ”‘ GENERAR CÃ“DIGO VERIFICACIÃ“N' : 'âŒ Completa formulario + checkbox'
        }}
      </button>
    </form>

    <!-- ğŸ”‘ PASO 2: CÃ“DIGO VISUAL (OCULTO hasta generar) -->
    <div class="codigo-container" *ngIf="mostrarCodigo">
      <h3>ğŸ“± COPIA ESTE CÃ“DIGO:</h3>
      <div class="codigo-grande">{{ codigoGenerado }}</div>
      <p class="instruccion-codigo">Ingresa abajo para confirmar tu cita:</p>
      <div class="input-codigo-group">
        <input
          [(ngModel)]="codigoVerificacion"
          maxlength="4"
          placeholder="4782"
          class="input-codigo"
          [ngModelOptions]="{ standalone: true }"
        />
        <button type="button" (click)="verificarCodigo()" class="btn-confirmar-final">
          âœ… CONFIRMAR CITA
        </button>
      </div>
    </div>

    <div class="modal-confirmacion" *ngIf="nuevaCita">
      <div class="confirmacion-card">
        <h2>ğŸ‰ Â¡CITA RESERVADA!</h2>

        <!-- ğŸ” ID Y CÃ“DIGO GRANDES -->
        <div class="id-codigo-container">
          <div class="id-grande">
            <span class="label-id">ID CITA</span>
            <strong>{{ nuevaCita.id }}</strong>
          </div>
          <div class="codigo-grande-final">
            <span class="label-codigo">CÃ“DIGO</span>
            <strong>{{ nuevaCita.codigoVerificacion }}</strong>
          </div>
        </div>

        <div class="detalles-confirmacion">
          <p>
            ğŸ‘¤ <strong>{{ nuevaCita.cliente }}</strong>
          </p>
          <p>ğŸ”§ {{ nuevaCita.servicio }}</p>
          <p>ğŸ“… {{ nuevaCita.fecha }} {{ nuevaCita.hora }}</p>
          <p>
            ğŸ’° <strong>${{ nuevaCita.costo }} MXN</strong>
          </p>
        </div>
        <p class="instruccion">
          ğŸ” <strong>GUARDAR ID</strong> para rastrear en
          <a routerLink="/cliente/citas" class="link-citas">Mis Citas</a>
        </p>
        <button type="button" (click)="irMisCitas()" class="btn-ir-citas">ğŸ“… Ver Mis Citas</button>
      </div>
    </div>
  </div>
</div>
